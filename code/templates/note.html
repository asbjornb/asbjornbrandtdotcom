<div class="note-layout">
    <div class="note-content">
        <article>
            {{{content}}}
        </article>

        <hr>

        {{> backlinks }}
    </div>

    {{> recent-notes-sidebar }}
</div>

{{#if GraphData.ConnectedNodes}}
<link rel="stylesheet" href="/assets/knowledge-graph.css">

<div class="connections-section">
    <div class="connected-notes">
        <h3>Connected Notes</h3>
        <div class="connection-links">
            {{#each GraphData.ConnectedNodes}}
            <a href="{{Url}}" class="connection-link">{{Title}}</a>
            {{/each}}
        </div>
    </div>
    
    <div class="mini-graph-container">
        <div class="graph-header">
            <span class="graph-icon" onclick="openGlobalGraph()" title="Explore full knowledge graph">⚡</span>
        </div>
        <div id="mini-graph" class="mini-graph" data-current-note="{{GraphData.CurrentNoteId}}"></div>
    </div>
</div>

<!-- Global Graph Modal -->
<div id="global-graph-modal" class="global-graph-modal">
    <div class="global-graph-header">
        <h2 class="global-graph-title">Knowledge Graph</h2>
        <button class="global-graph-close" onclick="closeGlobalGraph()" title="Close">&times;</button>
    </div>
    <div class="global-graph-container">
        <div id="global-graph" class="global-graph"></div>
        <div class="global-graph-controls">
            <h4>Controls</h4>
            <div class="control-group">
                <label>Zoom</label>
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="zoom-btn" onclick="zoomOut()">−</button>
                    <button class="zoom-btn" onclick="resetZoom()">Reset</button>
                </div>
            </div>
            <div class="control-group">
                <label>Legend</label>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <span>Hub Nodes</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f39c12;"></div>
                        <span>Categories</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <span>Notes</span>
                    </div>
                </div>
            </div>
            <div class="control-group">
                <div id="graph-stats" class="graph-stats"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="/assets/knowledge-graph.js"></script>
{{/if}}
